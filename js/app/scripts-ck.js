/*
 *  This file holds the scripts for the form to build the circles
 */var Spinner=Spinner||{};Spinner.Builder={addCategory:$(".add-category"),goToWheel:$("#go-to-garden"),generateLink:$("#generate-link"),startOver:$("#clear-all"),wheels:$(".wheel-form"),wheelOneCats:$("#wheel-1 .wheel-categories"),wheelTwoCats:$("#wheel-2 .wheel-categories"),wheelOneTitle:$("#wheel-1-title"),wheelTwoTitle:$("#wheel-2-title"),wheelOneCatList:[],wheelTwoCatList:[],innerCatCount:1,outerCatCount:1,errorDisplay:$("#errorMsg"),init:function(){this.events()},addNewCategoryEntry:function(e){var t=e+1,n=Spinner.Builder.wheels.eq(e).find(".category").length+1,r=$('<div class="category'+(e===0?" inner":" outer")+'">							<input type="text" size="20" class="cat-input wheel-'+t+"-cat-"+n+'"  placeholder="Category name">							<input type="button" name="" id="remove-'+t+"-"+n+'" class="remove-category" value="Remove">						</div>');switch(e){case 0:Spinner.Builder.wheelOneCats.append(r);break;case 1:Spinner.Builder.wheelTwoCats.append(r)}r.hide().css("opacity",0).slideDown().animate({opacity:1},{queue:!1});e===0?Spinner.Builder.innerCatCount++:e===1&&Spinner.Builder.outerCatCount++},removeCategory:function(e){var t=this.howManyCategories(e);t>1?$(e).parents(".category").slideUp(function(){$(this).remove()}).animate({opacity:0},{queue:!1}):this.displayError("You can't delete all of your categories!");$(e).hasParent(".outer")?Spinner.Builder.outerCatCount--:$(e).hasParent(".inner")&&Spinner.Builder.innerCatCount--},howManyCategories:function(e){return $(e).parents(".wheel-form").find(".category").length},checkCategoryRatio:function(e){e.preventDefault();Spinner.Builder.innerCatCount%Spinner.Builder.outerCatCount===0||Spinner.Builder.outerCatCount%Spinner.Builder.innerCatCount===0?Spinner.Builder.buildAnimation():Spinner.Builder.displayError("Both list of categories should be divisible by one another (i.e. one is 3 items and the other 6).")},displayError:function(e){function t(e){switch(e.animationName){case"showError":Spinner.Builder.errorDisplay.removeClass("isShown")}}this.errorDisplay.text(e).addClass("isShown");this.errorDisplay[0].addEventListener("animationend",t);this.errorDisplay[0].addEventListener("webkitAnimationEnd",t)},buildAnimation:function(){var e=Spinner.Builder;if(e.wheelTwoTitle.val().length===0||e.wheelOneTitle.length===0){Spinner.Builder.displayError("Please make sure each wheel has at least three categories and a title.");return!1}e.wheelOneCats.find(".category").each(function(e,t){t=$(t);var n=t.find("input").val();Spinner.Builder.wheelOneCatList.push(n);Spinner.Animation.spinnerOneChosenCount.push(1)});e.wheelTwoCats.find(".category").each(function(e,t){t=$(t);var n=t.find("input").val();Spinner.Builder.wheelTwoCatList.push(n);Spinner.Animation.spinnerTwoChosenCount.push(1)});Spinner.Animation.buildSpinners(Spinner.Builder.wheelOneCatList,Spinner.Builder.wheelTwoCatList)},startOver:function(){},events:function(){this.addCategory.on("click",function(e){e.preventDefault();Spinner.Builder.addNewCategoryEntry(Spinner.Builder.addCategory.index(this))});$(".container").on("click",".remove-category",function(e){e.preventDefault();Spinner.Builder.removeCategory(this)});$(document).on("click",".remove-cat",function(e){});this.goToWheel.on("click",this.checkCategoryRatio)}};Spinner.Animation={spinners:null,spinnerOneOptions:["bag","chair","table","sheep"],spinnerTwoOptions:["kangaroo","dust ball","loo","mouse","head","nose"],spinnerOneChosenCount:[],spinnerTwoChosenCount:[],timeoutLength:400,modifier:-20,spinCount:38,wordSpinnerOne:$("#word-spinner-1"),wordSpinnerTwo:$("#word-spinner-2"),currentWordOne:0,currentWordTwo:0,winners:null,fullListOfWinners:[],buildSpinners:function(e,t){Spinner.Animation.spinners=$(".inner-spinner");this.spinnerOneOptions=e;this.spinnerTwoOptions=t;this.workOutRatio();$(".wheel-1 h2").html(Spinner.Builder.wheelOneTitle.val());$(".wheel-2 h2").html(Spinner.Builder.wheelTwoTitle.val());$("#wheel-builder").fadeOut(function(){$(".spinners").fadeIn()});$("#spin").on("click",function(e){e.preventDefault();Spinner.Animation.spinWheels();Spinner.Animation.animateText()})},workOutRatio:function(){var e=0;if(Spinner.Builder.innerCatCount>Spinner.Builder.outerCatCount){e=spinner.Builder.innerCatCount/Spinner.Builder.outerCatCount;this.multiplyArray(this.spinnerTwoChosenCount,e)}else if(Spinner.Builder.innerCatCount<Spinner.Builder.outerCatCount){e=Spinner.Builder.outerCatCount/Spinner.Builder.innerCatCount;this.multiplyArray(this.spinnerOneChosenCount,e)}log(this.spinnerOneChosenCount,this.spinnerTwoChosenCount)},multiplyArray:function(e,t){for(var n=0;n<e.length;n++)e[n]=e[n]*t},spinWheels:function(){function e(e){switch(e.animationName){case"spin":Spinner.Animation.spinners.removeClass("start-spin")}}Spinner.Animation.spinners.addClass("start-spin");Spinner.Animation.spinners.eq(0)[0].addEventListener("animationend",e);Spinner.Animation.spinners.eq(0)[0].addEventListener("webkitAnimationEnd",e)},animateText:function(){this.winners=[this.pickWinner(1),this.pickWinner(2)];Spinner.Animation.wordSpinnerOne.add(Spinner.Animation.wordSpinnerTwo).removeClass("is-finished");this.fireWordSpinner()},fireWordSpinner:function(){var e=Spinner.Animation;e.wordSpinnerOne.html(e.spinnerOneOptions[e.currentWordOne]);e.currentWordOne++;e.currentWordOne>=e.spinnerOneOptions.length&&(e.currentWordOne=0);e.wordSpinnerTwo.html(e.spinnerTwoOptions[e.currentWordTwo]);e.currentWordTwo++;e.currentWordTwo>=e.spinnerTwoOptions.length&&(e.currentWordTwo=0);if(e.timeoutLength<100)if(e.spinCount===0)e.modifier=20;else{e.modifier=0;e.spinCount--}e.timeoutLength=e.timeoutLength+e.modifier;if(e.timeoutLength<400)window.setTimeout(e.fireWordSpinner,e.timeoutLength);else{var t=e.spinnerOneOptions[e.winners[0]];winnerTwoWord=e.spinnerTwoOptions[e.winners[1]];e.wordSpinnerOne.html(t);e.wordSpinnerTwo.html(winnerTwoWord);e.fullListOfWinners.push([t,winnerTwoWord]);e.spinnerOneChosenCount[e.winners[0]]--;e.spinnerTwoChosenCount[e.winners[1]]--;log(e.spinnerOneChosenCount,e.spinnerTwoChosenCount);if(e.spinnerOneChosenCount[e.winners[0]]===0){e.spinnerOneOptions.splice(e.winners[0],1);e.spinnerOneChosenCount.splice(e.winners[0],1)}if(e.spinnerTwoChosenCount[e.winners[1]]===0){e.spinnerTwoOptions.splice(e.winners[1],1);e.spinnerTwoChosenCount.splice(e.winners[1],1)}e.wordSpinnerOne.add(e.wordSpinnerTwo).addClass("is-finished");e.resetTimings()}},resetTimings:function(){Spinner.Animation.timeoutLength=400;Spinner.Animation.modifier=-20;Spinner.Animation.spinCount=38},pickWinner:function(e){if(e===1)return this.getRandomInt(0,this.spinnerOneOptions.length-1);if(e===2)return this.getRandomInt(0,this.spinnerTwoOptions.length-1)},getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e}};Spinner.Builder.init();